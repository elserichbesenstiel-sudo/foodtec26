<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>FoodTec ‚Äì Skizzen</title>

  <!-- Optional: globale App-CSS -->
  <link rel="stylesheet" href="./style.css" />

  <style>
    :root{
      --bg:#050b12; --panel:#0f1724; --panel2:#111c2b; --card:#0e1622;
      --border:#1c2a3b; --text:#f5f7fb; --muted:#a2afc5; --accent:#2b78e4;
      --good:#45c86a; --bad:#e74a4a; --warn:#f1c40f; --radius:18px;
      --shadow:0 14px 40px rgba(0,0,0,.35);
      --font:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif;
    }
    *{box-sizing:border-box}
    body{
      margin:0;font-family:var(--font);
      background:radial-gradient(1200px 700px at 25% -10%, #14325a 0%, rgba(20,50,90,0) 55%), var(--bg);
      color:var(--text)
    }
    .wrap{max-width:980px;margin:0 auto;padding:16px}
    .topbar{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin-bottom:14px}
    .pill{display:flex;align-items:center;gap:8px;padding:8px 12px;border:1px solid var(--border);border-radius:999px;background:rgba(15,23,36,.7);backdrop-filter:blur(8px)}
    .dot{width:10px;height:10px;border-radius:999px;background:var(--bad)}
    .dot.ok{background:var(--good)}
    .btn{border:0;background:var(--accent);color:white;padding:10px 14px;border-radius:14px;font-weight:700;cursor:pointer;box-shadow:var(--shadow)}
    .btn.secondary{background:transparent;border:1px solid var(--border);color:var(--text);box-shadow:none}
    .btn.danger{background:transparent;border:1px solid rgba(231,74,74,.5);color:#ffbdbd}
    .btn:disabled{opacity:.55;cursor:not-allowed}
    .grid{display:grid;grid-template-columns:1.1fr .9fr;gap:14px}
    @media (max-width:900px){.grid{grid-template-columns:1fr}}
    .card{background:linear-gradient(180deg, rgba(17,28,43,.85), rgba(14,22,34,.85));border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);overflow:hidden}
    .card-h{display:flex;justify-content:space-between;align-items:center;padding:14px 14px;border-bottom:1px solid rgba(255,255,255,.06)}
    .card-h h2{margin:0;font-size:18px}
    .card-b{padding:14px}
    .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .muted{color:var(--muted)}
    .in{width:100%;padding:12px 12px;border-radius:14px;border:1px solid rgba(255,255,255,.08);background:rgba(7,12,18,.55);color:var(--text);outline:none}
    textarea.in{min-height:96px;resize:vertical}
    .list{display:flex;flex-direction:column;gap:10px;max-height:380px;overflow:auto;padding-right:2px}
    .item{border:1px solid rgba(255,255,255,.08);background:rgba(5,11,18,.35);border-radius:16px;padding:12px;cursor:pointer}
    .item.active{outline:2px solid rgba(69,200,106,.5)}
    .item .t{font-weight:800}
    .item .s{display:flex;gap:10px;align-items:center;color:var(--muted);font-size:12px;margin-top:4px}
    .hr{height:1px;background:rgba(255,255,255,.06);margin:14px 0}
    .tag{display:inline-flex;gap:6px;align-items:center;padding:4px 8px;border-radius:999px;border:1px solid rgba(255,255,255,.08);font-size:12px;color:var(--muted)}
    .preview{
      width:100%;
      aspect-ratio: 4/5;
      background:rgba(0,0,0,.18);
      border:1px solid rgba(255,255,255,.08);
      border-radius:16px;
      overflow:hidden;
      display:flex;align-items:center;justify-content:center;
    }
    .preview img{max-width:100%;max-height:100%;display:block}
    .versions{display:flex;flex-direction:column;gap:10px}
    .ver{border:1px solid rgba(255,255,255,.08);border-radius:16px;padding:12px;background:rgba(5,11,18,.3)}
    .ver .top{display:flex;gap:10px;align-items:center;justify-content:space-between;flex-wrap:wrap}
    .ver .meta{display:flex;gap:10px;align-items:center;flex-wrap:wrap;color:var(--muted);font-size:12px}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:12px;opacity:.9}
    .link{color:#b8d3ff;text-decoration:none}
    .link:hover{text-decoration:underline}

    /* Modal */
    .modal{
      position:fixed;inset:0;display:none;align-items:center;justify-content:center;
      background:rgba(0,0,0,.62);backdrop-filter:blur(8px);padding:14px;z-index:50;
    }
    .modal.open{display:flex}
    .modal-card{
      width:min(980px, 100%);
      background:linear-gradient(180deg, rgba(17,28,43,.95), rgba(14,22,34,.95));
      border:1px solid var(--border);border-radius:22px;box-shadow:var(--shadow);overflow:hidden;
    }
    .modal-h{display:flex;align-items:center;justify-content:space-between;padding:12px 14px;border-bottom:1px solid rgba(255,255,255,.06)}
    .modal-h .ttl{display:flex;gap:10px;align-items:center;font-weight:900}
    .modal-b{padding:14px}
    .tools{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .tool{padding:10px 12px;border-radius:999px;border:1px solid rgba(255,255,255,.08);background:rgba(5,11,18,.35);color:var(--text);cursor:pointer;font-weight:800}
    .tool.active{outline:2px solid rgba(43,120,228,.55)}
    canvas{touch-action:none}
    .canvasWrap{
      border:1px solid rgba(255,255,255,.08);
      border-radius:18px;
      background:rgba(0,0,0,.18);
      overflow:hidden;
    }
  </style>

  <!-- Firebase v8 compat -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>
</head>

<body>
  <div class="wrap">

    <div class="topbar">
      <div class="pill"><span class="dot" id="dot"></span><b id="connTxt">Verbinden‚Ä¶</b></div>
      <div class="pill">BV: <b id="bvName">Sandritter</b></div>
      <div class="pill">Fallback: <b id="uploaderFallback">f√ºr Sandritter</b></div>
      <button class="btn secondary" id="btnRefresh">‚Üª Aktualisieren</button>
    </div>

    <div class="grid">
      <!-- LEFT -->
      <div class="card">
        <div class="card-h">
          <h2>üóÇÔ∏è Skizzen-Notizen</h2>
          <button class="btn" id="btnNew">+ Neu</button>
        </div>
        <div class="card-b">
          <input class="in" id="q" placeholder="Suche: z.B. K√ºche, Decke, Fenster..." />
          <div class="hr"></div>
          <div class="list" id="list"></div>
          <div class="muted" id="emptyHint">Keine Notizen gefunden.</div>
        </div>
      </div>

      <!-- RIGHT -->
      <div class="card">
        <div class="card-h">
          <h2>üìù Notiz</h2>
          <span class="tag" id="noteIdTag">kein Datensatz</span>
        </div>

        <div class="card-b">
          <div class="muted" style="margin-bottom:6px">Uploader-Name (bis Login aktiv ist)</div>
          <input class="in" id="uploaderName" />
          <div class="muted" style="margin-top:8px">
            Sp√§ter mit Login wird automatisch <span class="mono">uploadedBy.uid/name/email</span> gesetzt.
          </div>

          <div class="hr"></div>

          <div class="muted" style="margin-bottom:6px">Titel</div>
          <input class="in" id="title" placeholder="z.B. K√ºche ‚Äì Wasserleitung links" />

          <div class="muted" style="margin:12px 0 6px">Notiz / Beschreibung</div>
          <textarea class="in" id="note" placeholder="Was ist zu sehen? Was muss ge√§ndert werden?"></textarea>

          <div class="row" style="margin-top:12px">
            <button class="btn" id="btnSave">üíæ Notiz speichern</button>
            <button class="btn danger" id="btnDelete">üóëÔ∏è L√∂schen</button>
          </div>

          <div class="muted" id="timeInfo" style="margin-top:10px"></div>

          <div class="hr"></div>

          <div class="row" style="align-items:flex-end">
            <div style="flex:1;min-width:220px">
              <div class="row" style="justify-content:space-between">
                <div class="muted" style="font-weight:800">üìé Version hochladen</div>
                <button class="btn secondary" id="btnMeasure" disabled>üìê Ma√ü-Overlay</button>
              </div>
              <div class="muted" style="margin-top:6px">
                Speicherpfad: <span class="mono" id="storePathHint">sketches/sandritter/{noteId}/vX-‚Ä¶</span>
              </div>

              <div style="margin-top:10px">
                <input class="in" type="file" id="file" accept="image/*" />
              </div>

              <div class="row" style="margin-top:10px">
                <button class="btn" id="btnUpload" disabled>‚¨ÜÔ∏è Als neue Version hochladen</button>
                <button class="btn secondary" id="btnFreeSketch" disabled>‚úèÔ∏è Skizze anfertigen</button>
              </div>

              <div class="muted" style="margin-top:10px">
                Status: <b id="uploadStatus">‚Äî</b>
              </div>
            </div>

            <div style="width:260px;max-width:100%">
              <div class="preview" id="preview"><span class="muted">Keine Vorschau</span></div>
            </div>
          </div>

          <div class="hr"></div>

          <div class="muted" style="font-weight:900;margin-bottom:10px">üßæ Versionen</div>
          <div class="versions" id="versions"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Free Sketch Modal -->
  <div class="modal" id="freeModal">
    <div class="modal-card">
      <div class="modal-h">
        <div class="ttl">‚úèÔ∏è Freie Skizze <span class="muted" style="font-weight:700">Tip: Finger/Stift ‚Äì Undo/Redo nutzen</span></div>
        <div class="row">
          <button class="btn secondary" id="freeClose">‚úñ</button>
        </div>
      </div>
      <div class="modal-b">
        <div class="tools" style="margin-bottom:10px">
          <button class="tool active" id="freePen">Stift</button>
          <button class="tool" id="freeEraser">Radierer</button>
          <input type="color" id="freeColor" value="#ffffff" style="width:48px;height:42px;border-radius:12px;border:1px solid rgba(255,255,255,.08);background:transparent" />
          <input type="range" id="freeSize" min="1" max="18" value="3" />
          <button class="tool" id="freeUndo">‚Ü© Undo</button>
          <button class="tool" id="freeRedo">‚Ü™ Redo</button>
          <button class="tool" id="freeClear" style="background:rgba(231,74,74,.15);border-color:rgba(231,74,74,.4)">üßº Clear</button>
          <button class="btn" id="freeSave">üíæ Als Version speichern</button>
        </div>

        <div class="canvasWrap">
          <canvas id="freeCanvas" width="900" height="900"></canvas>
        </div>

        <div class="muted" style="margin-top:10px">
          Speichern erzeugt ein PNG und l√§dt es als <b>neue Version</b> hoch.
        </div>
        <div class="muted" id="freeHint" style="margin-top:6px"></div>
      </div>
    </div>
  </div>

  <!-- Measure Overlay Modal -->
  <div class="modal" id="measureModal">
    <div class="modal-card">
      <div class="modal-h">
        <div class="ttl">üìê Ma√ü-Overlay <span class="muted" style="font-weight:700">Tipp: Ma√ülinie ziehen (üèπ), Text setzen (abc), Auswahl: bewegen</span></div>
        <div class="row">
          <button class="btn secondary" id="measureClose">‚úñ</button>
        </div>
      </div>

      <div class="modal-b">
        <div class="tools" style="margin-bottom:10px">
          <button class="tool active" id="mSelect">üîé Auswahl</button>
          <button class="tool" id="mDim">üìè Ma√ülinie</button>
          <button class="tool" id="mText">abc Text</button>

          <button class="tool" id="mUndo">‚Ü© Undo</button>
          <button class="tool" id="mRedo">‚Ü™ Redo</button>
          <button class="tool" id="mClear" style="background:rgba(231,74,74,.15);border-color:rgba(231,74,74,.4)">üßº Clear</button>

          <input class="in" id="mTextInput" style="max-width:240px" placeholder="z.B. 5,80 m / 5800 mm" />
          <input type="range" id="mWidth" min="1" max="12" value="4" />
          <input type="color" id="mColor" value="#ffffff" style="width:48px;height:42px;border-radius:12px;border:1px solid rgba(255,255,255,.08);background:transparent" />

          <button class="btn" id="mExport">üñºÔ∏è Export & als Version speichern</button>
        </div>

        <div class="canvasWrap">
          <canvas id="measureCanvas" width="900" height="900"></canvas>
        </div>

        <div class="muted" id="mHint" style="margin-top:10px"></div>
      </div>
    </div>
  </div>

  <!-- ‚úÖ Externe Logik -->
  <script src="./skizzen.js"></script>
</body>
</html>
